title: æµ…æ git æ•°æ®ç®¡ç†
date: 2019-09-01
tags:
- git

---

ä¸¤ä¸ªæœˆå‰ï¼Œå›¢é˜Ÿæ¥äº†ä¸ªæ–°çš„å®ä¹ ç”Ÿã€‚æˆ‘ä»¬è®©ä»–ååŠ©å¼€å‘ä¸€ä¸ª Java æœåŠ¡ã€‚ç¬¬äºŒå¤©å‘ç”Ÿäº†ä¸€ä¸ªé¬¼æ•…äº‹ï¼š

> *å®ä¹ ç”ŸèŠ±äº†1ä¸ªå°æ—¶æ¥ä¸‹è½½ git å·¥ä½œä»“åº“*

<!--more-->

å¥½ä¸å®¹æ˜“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œå¯è§çš„ä»£ç æœ¬èº«åªæœ‰å‡ å M çš„å¤§å°ï¼Œä½†åœ¨å‘½ä»¤è¡Œä¸­æŸ¥çœ‹ä»“åº“æ—¶ï¼Œå‘ç°åœ¨ `.git` ç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸º `xxxx.pack` çš„æ–‡ä»¶ï¼Œå¤§å°ç«Ÿç„¶æœ‰ 1.6Gã€‚

è¿™æ—¶æˆ‘å’Œå®ä¹ ç”Ÿéƒ½æ‡µé€¼äº†ï¼š

> ä¸ºä»€ä¹ˆè¿™ä¸ªæ–‡ä»¶ä¼šè¿™ä¹ˆå¤§ï¼Ÿè¿™ä¸ªæ–‡ä»¶æ˜¯å¹²å˜›çš„ï¼Ÿ

æˆ‘çªç„¶å‘ç°ï¼Œè‡ªå·±æ¯å¤©éƒ½åœ¨ä½¿ç”¨çš„ gitï¼Œå…¶å®èƒŒåéšè—äº†å¤§é‡è‡ªå·±ä¸äº†è§£çš„ç»†èŠ‚ã€‚è¿™ç¯‡æ–‡ç« çš„å‡ºå‘ç‚¹ï¼Œå°±æ˜¯å¯¹å…¶ä¸­è‡ªå·±ä¸æ±‚ç”šè§£çš„éƒ¨åˆ†ï¼Œåšä¸€ä¸ªå……åˆ†çš„è§£è¯»ã€‚

## Pre-requisite

ä¸ºäº†ä¾¿äºç†è§£ï¼Œåœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« å‰ï¼Œä½ éœ€è¦å¯¹ git æœ‰åŸºæœ¬çš„ä½¿ç”¨ç»éªŒã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå¯ä»¥å…ˆä»å»–é›ªå³°çš„ [git æ•™ç¨‹](https://www.liaoxuefeng.com/wiki/896043488029600) å¼€å§‹ã€‚

è¯»è€…ä¹Ÿå¯ä»¥çœ‹ä¸‹ [å›¾è§£ git](https://marklodato.github.io/visual-git-guide/index-zh-cn.html)ï¼Œå¯ä»¥å¯¹ git åŸºæœ¬æ“ä½œæœ‰æ›´ç›´è§‚çš„è®¤è¯†ã€‚

## ç›®å½•

- ç‰ˆæœ¬æ§åˆ¶çš„æœ¬è´¨
- git æ–‡ä»¶ç®¡ç†
  - ä¸‰ä¸ªæ–‡ä»¶åŒºåŸŸ
  - æ–‡ä»¶çš„å››ç§çŠ¶æ€
  - git æ•°æ®åº“
- åˆ†æ”¯çš„ç§˜å¯†
  - ä»åˆ†å‰åˆ°åˆ†æ”¯
  - HEAD
  - ref, refs! {WIP}
  - åˆ†æ”¯çš„åˆå¹¶
- å›åˆ° .pack æ–‡ä»¶ -- git ä¼˜åŒ–

## ç‰ˆæœ¬æ§åˆ¶çš„æœ¬è´¨

æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªé¡¹ç›®ï¼šæ²¡æœ‰ gitï¼Œæ²¡æœ‰ SVNï¼Œæ²¡æœ‰ä»»ä½•å¯ç”¨å·¥å…·ã€‚**æˆ‘ä»¬å¦‚ä½•ä¿è¯ï¼šå¯ä»¥ä¿ç•™è¿™ä¸ªé¡¹ç›®ä¸åŒçš„ç‰ˆæœ¬ï¼Œå½“æŸä¸€ä¸ªç‰ˆæœ¬å‡ºäº†é—®é¢˜æ—¶ï¼Œå¯ä»¥å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬å‘¢ï¼Ÿ**

è¿™é‡Œçš„ **ç‰ˆæœ¬**ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šå½“å‰é¡¹ç›®ä¸­çš„ **æ‰€æœ‰æ–‡ä»¶çš„å‰¯æœ¬** çš„é›†åˆã€‚æ¯”å¦‚ï¼š

> 1. ä»Šå¤©æ—©ä¸Š10ç‚¹ï¼ŒæŸåŒäº‹ A å‘é¡¹ç›®ä¸­æ·»åŠ äº† `list.js`ï¼ŒåŠ äº†10è¡Œä»£ç 
> 2. ä¸‹åˆ3ç‚¹ï¼ŒæŸåŒäº‹ A å‘ç° `list.js` é‡Œæœ‰ bugï¼Œäºæ˜¯ä¿®æ”¹äº†å…¶ä¸­çš„3è¡Œä»£ç 
> 3. æ™šä¸Š8ç‚¹ï¼ŒæŸåŒäº‹ B æ·»åŠ äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œåˆç»™ `list.js` å¢åŠ äº†20è¡Œä»£ç 

ä»¥ä¸Šçš„æ¯ä¸€ä¸ªæ“ä½œä¹‹åï¼Œæˆ‘ä»¬éƒ½å¾—åˆ°äº†1ä¸ªå…³äº `list.js` åœ¨è¿™ä¸ªä»“åº“ä¸­çš„å‰¯æœ¬ã€‚æ‰€è°“ç‰ˆæœ¬æ§åˆ¶ï¼Œæ— éå°±æ˜¯æ§åˆ¶æŸä¸ªæ–‡ä»¶å¤¹ä¸­æ‰€æœ‰çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬åµŒå¥—æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶ï¼‰çš„å‰¯æœ¬ï¼Œå¹¶å…è®¸æˆ‘ä»¬éšæ„åœ°è°ƒç”¨è¿™äº›å‰¯æœ¬çš„æ•°æ®ã€‚

æ‰€ä»¥å›åˆ°æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„æ—¶å€™ï¼Œæœ€ç®€å•çš„æ–¹æ³•å½“ç„¶æ˜¯ï¼š`Ctrl-C` + `Ctrl-V` â€”â€” å½“æˆ‘ä»¬éœ€è¦ä¿ç•™å…¶ä¸­ä¸€ä¸ªã€Œç‰ˆæœ¬ã€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹çš„ä»£ç ï¼Œå¤åˆ¶å‡ºæ¥ï¼Œç„¶åå–ä¸ªåå­— *v1*ï¼Œç”šè‡³å†å‹ç¼©æ‰“åŒ…ä¸€ä¸‹å˜æˆ *v1.zip*ï¼Œç„¶åå­˜èµ·æ¥ã€‚è¿™æ ·ä¸æ–­é‡å¤ï¼Œå¯¹æ¯ä¸€ä¸ªå€¼å¾—ä¿å­˜çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬éƒ½ç»™å®ƒæ‰§è¡Œè¿™æ ·çš„æ“ä½œï¼Œå¾—åˆ° *v2, v3, v4, ...*

è¿™æ ·ï¼Œå½“æˆ‘ä»¬å‘å¸ƒäº†ä¸€ä¸ªæ–°ç‰ˆæœ¬æ—¶ï¼Œå¦‚æœå®ƒæœ‰é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«çš„æ¢å¤åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼›æ¯ä¸ªæ–‡ä»¶åœ¨æ¯ä¸ªç‰ˆæœ¬çš„å‰¯æœ¬ï¼Œéƒ½è¢«ä¿ç•™ä¸‹æ¥äº†ã€‚

**è¿™å½“ç„¶æ˜¯ä¸€ç§æœ‰æ•ˆçš„åšæ³•ï¼Œä½†å®ƒç¡®å®åˆæ˜¯ä¸€ä¸ªä½æ•ˆçš„åšæ³•ï¼š**

* é“ç†ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬åªè¦ä¿å­˜æ¯ä¸ªæ–°çš„ã€Œç‰ˆæœ¬ã€ä¸­è¢«ä¿®æ”¹è¿‡çš„æ–‡ä»¶å°±è¡Œäº†ï¼Œä¸éœ€è¦æ‰€æœ‰çš„æ–‡ä»¶éƒ½å¤åˆ¶ä¸€é
* å¤åˆ¶ç²˜è´´é‡å‘½åçš„æ“ä½œï¼Œé‡å¤ç¹çï¼Œä¸”å®¹æ˜“å‡ºé”™ï¼ˆä¸‡ä¸€æé”™ç‰ˆæœ¬å·ï¼Œé‚£å°±ç³Ÿç³•äº†ï¼‰
* å¦‚æœæœ‰å¤šä¸ªäººä¸€èµ·å·¥ä½œæ€ä¹ˆåŠå‘¢ï¼Ÿæ€ä¹ˆçº¦å®šæ‰€è°“çš„ã€Œç‰ˆæœ¬å·ã€å‘¢ï¼Ÿ
* å¦‚æœä¸¤ä¸ªäººéƒ½å¸Œæœ›å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œä½†ä¸¤ä¸ªäººä¿®æ”¹çš„ä»£ç æ˜¯åŒä¸€ä¸ªä½ç½®åˆæ€ä¹ˆåŠå‘¢ï¼Ÿ
* ...

å¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ¥å®¡è§†ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå®ƒå¿…é¡»è¦èƒ½å¤Ÿè§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š

1. å®ƒå¯ä»¥åœ¨æ¯ä¸ªç‰ˆæœ¬ä¸­ â€œä¿å­˜â€ æ¯ä¸ªæ–‡ä»¶çš„å‰¯æœ¬ï¼ˆç‰¹åˆ«æ˜¯ï¼Œä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼‰
2. å®ƒå¯ä»¥ä¿è¯ã€Œç‰ˆæœ¬å·ã€çš„å”¯ä¸€æ€§
3. å½“æœ‰å¤šä¸ªäººä¸€èµ·åä½œæ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡æŸäº›è§„åˆ™ï¼Œè§£å†³ä¸åŒäººå¯¹åŒä¸€ä¸ªæ–‡ä»¶çš„ä¿®æ”¹çš„åˆå¹¶é—®é¢˜
4. ...

æ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹çœ‹ git æ˜¯å¦‚ä½•åˆ†åˆ«è§£å†³è¿™äº›é—®é¢˜çš„ã€‚

## git æ–‡ä»¶ç®¡ç†

åœ¨è¯¦ç»†ä»‹ç» git æ–‡ä»¶ç®¡ç†ä¹‹å‰ï¼Œå¸Œæœ›å¤§å®¶å¯ä»¥æŠŠä¸€å¥è¯å…ˆç‰¢ç‰¢è®°ä¸‹æ¥ï¼š

> *git ä¿å­˜çš„ä¸æ˜¯æ–‡ä»¶çš„å˜åŒ–æˆ–è€…å·®å¼‚ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—ä¸åŒæ—¶åˆ»çš„æ–‡ä»¶å¿«ç…§*
> <br>
> *git ä¿å­˜çš„ä¸æ˜¯æ–‡ä»¶çš„å˜åŒ–æˆ–è€…å·®å¼‚ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—ä¸åŒæ—¶åˆ»çš„æ–‡ä»¶å¿«ç…§*
> <br>
> *git ä¿å­˜çš„ä¸æ˜¯æ–‡ä»¶çš„å˜åŒ–æˆ–è€…å·®å¼‚ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—ä¸åŒæ—¶åˆ»çš„æ–‡ä»¶å¿«ç…§*

å½“æˆ‘ä»¬åœ¨ git ä»“åº“ä¸­æäº¤æ›´æ–°ï¼Œæˆ–è€…ä¿å­˜é¡¹ç›®çŠ¶æ€æ—¶ï¼Œgit ä¼šå¯¹å½“æ—¶çš„å…¨éƒ¨æ–‡ä»¶åˆ¶ä½œå‰¯æœ¬ï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºâ€œå¿«ç…§â€ï¼‰ï¼Œå¹¶ä¸ºæ¯ä»½å¿«ç…§éƒ½æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ç´¢å¼•ã€‚å¦‚æœæœ‰äº›æ–‡ä»¶æ²¡æœ‰è¢«æ›´æ–°ï¼Œé‚£ä¹ˆ git ä¸ä¼šå¯¹å…¶ç”Ÿæˆæ–°çš„å‰¯æœ¬ï¼Œè€Œæ˜¯åœ¨æäº¤è®°å½•ä¸­ä¿ç•™æŒ‡å‘ä¹‹å‰å­˜å‚¨çš„æ–‡ä»¶çš„é“¾æ¥ã€‚

### ä¸‰ä¸ªæ–‡ä»¶åŒºåŸŸ

git é¡¹ç›®ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶åŒºåŸŸçš„æ¦‚å¿µï¼š

* é¦–å…ˆï¼Œgit ä¼šå°†æ‰€æœ‰çš„ä»£ç å‰¯æœ¬å’Œé¡¹ç›®å…ƒæ•°æ®ï¼ˆæäº¤å†å²ï¼Œç›®å½•ç»“æ„ï¼‰ï¼Œéƒ½å­˜æ”¾åœ¨ä¸€ä¸ª `.git` çš„ç›®å½•ä¸­ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªç›®å½•ä¸ºã€Œç‰ˆæœ¬åº“ã€ï¼›
* æ­¤å¤–ï¼Œå½“å‰çš„å·¥ä½œç›®å½•ï¼Œç›´æ¥å¯è§çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç§°ä¸ºã€Œå·¥ä½œåŒºã€ï¼›
* æœ€åï¼Œä¸ºäº†æ–¹ä¾¿è®°å½•æˆ‘ä»¬å¯¹æ–‡ä»¶çš„ä¿®æ”¹ï¼Œgit è¿˜æä¾›äº†ä¸€ä¸ªã€Œæš‚å­˜åŒºã€ï¼ˆ`staging area`ï¼‰ï¼Œä¸´æ—¶å¯„æ”¾æˆ‘ä»¬æ–°å¢çš„æˆ–è€…ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œç›¸å½“äºä¸€ä¸ªç­‰å€™åŒºã€‚

ä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨ã€Œå·¥ä½œåŒºã€ä¸­æ–°å¢æˆ–è€…ä¿®æ”¹æŸäº›æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ `git add` â€”â€” è¿™æ—¶è¢«æ·»åŠ çš„æ–‡ä»¶çš„å¿«ç…§å°†è¢«æ”¾å…¥åˆ°ã€Œæš‚å­˜åŒºã€ï¼Œç›´åˆ°æˆ‘ä»¬é€šè¿‡ `commit` æŒ‡ä»¤æäº¤è¿™äº›å˜æ›´ï¼Œæ°¸ä¹…åœ°å­˜å…¥åˆ°ã€Œç‰ˆæœ¬åº“ã€ä¸­ã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›å¯ä»¥åœ¨ã€Œå·¥ä½œåŒºã€ä¸­æŸ¥çœ‹æŸä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `checkout` æŒ‡ä»¤ï¼Œä»ã€Œç‰ˆæœ¬åº“ã€ä¸­è°ƒæ¡£ï¼ŒæŠŠæŸä¸ªç‰ˆæœ¬çš„æ•°æ®è°ƒå–å‡ºæ¥ã€‚

![](https://git-scm.com/book/en/v2/images/areas.png)

### æ–‡ä»¶çš„å››ç§çŠ¶æ€

è™½ç„¶ git æœ‰ä¸‰ä¸ªæ–‡ä»¶åŒºåŸŸï¼Œä½†å®é™…ä¸Šåœ¨é¡¹ç›®ä¸­çš„æ–‡ä»¶ï¼Œç†è®ºä¸Šå¯ä»¥æœ‰4ç§ä¸åŒçŠ¶æ€ï¼š

* `untracked` - git è¿˜æ²¡æœ‰ã€Œè·Ÿè¸ªã€è¯¥æ–‡ä»¶
* `unmodified` - å½“å‰æ–‡ä»¶å’Œæœ€è¿‘æäº¤è®°å½•çš„æ–‡ä»¶çš„çŠ¶æ€ï¼Œæ˜¯å®Œå…¨ä¸€è‡´çš„
* `modified` - å½“å‰æ–‡ä»¶å’Œæœ€è¿‘æäº¤è®°å½•çš„æ–‡ä»¶ç›¸æ¯”ï¼Œåšäº†ä¸€å®šçš„ä¿®æ”¹
* `staged` - æ–‡ä»¶åšäº†ä¿®æ”¹ï¼Œä¸”è¿™äº›ä¿®æ”¹è¢«æš‚å­˜èµ·æ¥äº†ã€‚

æ¯ä¸ªçŠ¶æ€ä»¥åŠæ›´æ”¹æ–‡ä»¶çŠ¶æ€çš„ git æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://git-scm.com/book/en/v2/images/lifecycle.png)

æ³¨ï¼šå¯¹äºæŸäº›æˆ‘ä»¬ä¸å¸Œæœ› git å»ç®¡çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®ƒä½äº `untracked` çŠ¶æ€æ—¶ï¼Œé€šè¿‡ `.gitignore` ä¸­çš„è§„åˆ™ï¼Œè®© git å¿½ç•¥å®ƒä»¬çš„å­˜åœ¨ã€‚

è¿™åŸºæœ¬æ˜¯ç»å¤§éƒ¨åˆ† git æ•™ç¨‹ä¼šå‘Šè¯‰æˆ‘ä»¬çš„ä¸œè¥¿ã€‚ä½†è¿™é‡Œè¯·å¤§å®¶æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š

1. **git é€šè¿‡ä»€ä¹ˆåˆ¤æ–­æˆ‘çš„æŸä¸ªæ–‡ä»¶æ˜¯å¦ä¸º `untracked` ï¼Ÿæ‰€è°“ã€Œè·Ÿè¸ªã€åˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ**
2. **è¯´ `.git` ç›®å½•ä»£è¡¨äº† git çš„ã€Œç‰ˆæœ¬åº“ã€ï¼Œé‚£å…·ä½“çš„ä»£ç å‰¯æœ¬æ˜¯å¦‚ä½•å­˜æ”¾çš„å‘¢ï¼Ÿ**

è¿™å°±è¦ä» git çš„æ ¸å¿ƒï¼šgit æ•°æ®åº“è¯´èµ·ã€‚

### git æ•°æ®åº“

**git çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ä¸€ä¸ªç®€å•çš„ key-value æ•°æ®åº“ï¼š** 

1. ä½ å¯ä»¥å‘æ•°æ®åº“æ’å…¥ä»»æ„ç±»å‹çš„å†…å®¹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé”®å€¼ï¼Œé€šè¿‡é”®å€¼å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å†æ¬¡æŸ¥è¯¢è¯¥å†…å®¹ã€‚
2. è¿™äº›æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ `.git/objects` ç›®å½•é‡Œçš„ï¼Œä»¥æ–‡ä»¶çš„å½¢å¼å­˜æ”¾ã€‚
3. `key` çš„å€¼æ˜¯ä¸€ä¸ª *40ä½çš„ SHA-1 hash*ï¼Œhash çš„å‰2ä¸ªå­—ç¬¦ç”¨äºå‘½åå­ç›®å½•ï¼Œä½™ä¸‹çš„38ä¸ªå­—ç¬¦ç”¨ä½œæ–‡ä»¶å

åœ¨ git æ•°æ®åº“ä¸­ï¼Œæœ‰4ç§ä¸åŒç±»å‹çš„å¯¹è±¡ï¼š

* blob - è®°å½•å•ä¸ªæ–‡ä»¶çš„æ•°æ®
* tree - å¯¹åº”è®°å½•æ–‡ä»¶å¤¹èŠ‚ç‚¹çš„æ•°æ®
* commit - è®°å½•ä¸€æ¬¡æäº¤è®°å½•
* tag - è®°å½•ä¸€ä¸ª tag

æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¼šæåˆ°å®ƒä»¬çš„å…·ä½“å½¢æ€å’Œæ•°æ®ç»“æ„ï¼Œä½†ç›®å‰æˆ‘ä»¬å…ˆä¸çº ç»“è¿™ä¸ªï¼Œåªéœ€è¦çŸ¥é“æœ‰è¿™å‡ æ ·ä¸œè¥¿å°±å¯ä»¥äº†ã€‚

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œè¿›è¡Œæ—¥å¸¸çš„ git æ“ä½œï¼Œç„¶åæŸ¥çœ‹ git çš„åŸå§‹æ•°æ®å­˜æ”¾æƒ…å†µã€‚

#### ä¸¾ä¸€ä¸ªæ —å­

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ï¼Œä½œä¸ºæˆ‘ä»¬çš„é¡¹ç›®åœ°å€ï¼Œå¹¶ç”¨ `git init` å°†å®ƒåˆå§‹åŒ–ï¼š

```sh
$ mkdir git-demo
$ cd git-demo
$ git init   # è¿™å°±åˆ›å»ºå¥½äº†
```

ç›®å‰é¡¹ç›®ç©ºç©ºå¦‚ä¹Ÿã€‚ä½†å®é™…ä¸Š git ä»“åº“å·²ç»å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ `.git` ç›®å½•ï¼š

```sh
$ tree .git  ### ä»¥ä¸‹æ˜¯è¾“å‡ºç»“æœ
.git
â”œâ”€â”€ HEAD
â”œâ”€â”€ config
â”œâ”€â”€ description
â”œâ”€â”€ hooks
â”‚Â Â  â”œâ”€â”€ applypatch-msg.sample
â”‚Â Â  â”œâ”€â”€ commit-msg.sample
â”‚Â Â  â”œâ”€â”€ post-update.sample
â”‚Â Â  â”œâ”€â”€ pre-applypatch.sample
â”‚Â Â  â”œâ”€â”€ pre-commit.sample
â”‚Â Â  â”œâ”€â”€ pre-push.sample
â”‚Â Â  â”œâ”€â”€ pre-rebase.sample
â”‚Â Â  â”œâ”€â”€ pre-receive.sample
â”‚Â Â  â”œâ”€â”€ prepare-commit-msg.sample
â”‚Â Â  â””â”€â”€ update.sample
â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ exclude
â”œâ”€â”€ objects
â”‚Â Â  â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ pack
â””â”€â”€ refs
    â”œâ”€â”€ heads
    â””â”€â”€ tags

8 directories, 14 files
```

è¿™é‡Œæˆ‘ä»¬å…ˆæŠ›å¼€åˆ«çš„æ–‡ä»¶ï¼Œåªçœ‹ `objects` ç›®å½•ã€‚ä¸éš¾çœ‹å‡ºï¼Œå®ƒç°åœ¨åªæœ‰ `info` å’Œ `pack` ä¸¤ä¸ªæ–‡ä»¶ï¼ˆæˆ‘ä»¬ç¨åå†æåˆ°ä»–ä»¬ï¼‰

æˆ‘ä»¬å°è¯•ç»™æ–‡ä»¶å¤¹é‡Œæ·»åŠ ç‚¹ä¸œè¥¿ï¼š

```sh
$ mkdir src
$ touch Readme.md src/index.js
$ echo 'this is some readme text huh' > Readme.md
```

ç„¶åæˆ‘ä»¬å†æŸ¥çœ‹ `.git/objects`ï¼š

```sh
$ tree .git/objects
.git/objects/
â”œâ”€â”€ info
â””â”€â”€ pack

2 directories, 0 files
```

å‘µ...å¹¶æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚é‚£å¦‚æœæˆ‘ä»¬æŠŠå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶æ”¾åˆ°ã€Œæš‚å­˜åŒºã€å‘¢ï¼š

```sh
$ git add Readme.md
$ tree .git/objects
.git/objects/
â”œâ”€â”€ ed
â”‚Â Â  â””â”€â”€ afe27e250ef26f694b25afce81bdaf96f44eb0
â”œâ”€â”€ info
â””â”€â”€ pack

3 directories, 1 file
```

å“¦è± â€”â€” åœ¨ `.git/objects` ä¸‹å¤šäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ `ed`ï¼Œæ–‡ä»¶å¤¹ä¸‹åˆå¸¦æœ‰ä¸€ä¸ªåä¸º `afe27e250ef26f694b25afce81bdaf96f44eb0` çš„æ–‡ä»¶ï¼Œä¸²åœ¨ä¸€èµ· `edafe27e250ef26f694b25afce81bdaf96f44eb0` åˆšå¥½æ˜¯40ä¸ªå­—ç¬¦ï¼Œè¿™å°±æ˜¯ git å¯¹è¿™ä¸ªæ–‡ä»¶ç”Ÿæˆçš„ SHA-1 hashã€‚

æˆ‘ä»¬å¯ä»¥ç”¨ `git cat-file` æ¥ç§ç§è¿™ä¸ªæ–‡ä»¶ï¼š

```sh
$ git cat-file -p edafe27e250ef26f694b25afce81bdaf96f44eb0 # -p è¾“å‡º git å¯¹è±¡çš„å†…å®¹
this is some readme text huh

$ git cat-file -t edafe27e250ef26f694b25afce81bdaf96f44eb0 # -t è¾“å‡º git å¯¹è±¡çš„ç±»å‹
blob
```

æ‰€ä»¥åœ¨æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°ã€Œæš‚å­˜åŒºã€æ—¶ï¼Œgit ä¼šå¯¹åº”åœ°åˆ›å»ºä¸€ä¸ª `blob` ç±»å‹çš„å¯¹è±¡ï¼ˆæ–‡ä»¶ï¼‰ï¼Œä¸”è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„æ˜¯ç”±ä¸€ä¸ª 40 ä½çš„ SHA-1 hash æŒ‡å®šçš„ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æäº¤è¿™ä¸ªä½äºã€Œæš‚å­˜åŒºã€çš„æ–‡ä»¶ï¼š

```sh
$ git commit -m 'add readme'
[master (root-commit) 4245348] add readme
 1 file changed, 1 insertion(+)
 create mode 100644 Readme.md

$ tree .git/objects
.git/objects
â”œâ”€â”€ 12
â”‚Â Â  â””â”€â”€ 0c03e073cdf409403224c406fdfb022a63e750
â”œâ”€â”€ 49
â”‚Â Â  â””â”€â”€ 0e706c59461270e6f3c0d47356ac84e8c0bc1b
â”œâ”€â”€ ed
â”‚Â Â  â””â”€â”€ afe27e250ef26f694b25afce81bdaf96f44eb0
â”œâ”€â”€ info
â””â”€â”€ pack

5 directories, 3 files
```

è¿™æ¬¡æäº¤åï¼Œæˆ‘ä»¬å‘ç°ï¼Œé™¤äº†åŸæœ¬çš„ `edafe...` å¤–ï¼Œ`objects` é‡Œé¢åˆå¤šäº†ä¸¤ä¸ªæ–‡ä»¶ï¼š`49/0e7...` å’Œ `12/0c0...`ï¼›åŒæ ·æˆ‘ä»¬å¯ä»¥åˆ†åˆ«æŸ¥çœ‹è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼š

```sh
$ git cat-file -t 120c03e073cdf409403224c406fdfb022a63e750
commit

$ git cat-file -p 120c03e073cdf409403224c406fdfb022a63e750 
tree 490e706c59461270e6f3c0d47356ac84e8c0bc1b
author Zeqiu Wu <allenwu1018@gmail.com> 1567341827 +0800
committer Zeqiu Wu <allenwu1018@gmail.com> 1567341827 +0800

add readme

```

ä¸éš¾çœ‹å‡ºï¼Œè¿™ç¬¬ä¸€ä¸ªæ–‡ä»¶å¯¹åº”çš„æ˜¯ä¸€ä¸ª `commit` ç±»å‹çš„å¯¹è±¡ï¼›å¯¹è±¡ä¸­çš„æ•°æ®è®°å½•äº†è¿™ä¸ª commit çš„ä½œè€…å’Œæäº¤è€…ï¼Œè¿˜æœ‰ commit msgï¼›æ­¤å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€è¡Œè®°å½•ï¼š`tree 490e706c59461270e6f3c0d47356ac84e8c0bc1b`ï¼Œè¿™é‡Œçš„ SHA-1 hash æ°å¥½æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶çš„ SHA-1 hashï¼š

```sh
$ git cat-file -t 490e706c59461270e6f3c0d47356ac84e8c0bc1b
tree

$ git cat-file -p 490e706c59461270e6f3c0d47356ac84e8c0bc1b
100644 blob edafe27e250ef26f694b25afce81bdaf96f44eb0	Readme.md
```

è€Œç¬¬äºŒä¸ªæ–‡ä»¶åˆ™æ˜¯ä¸€ä¸ª `tree` ç±»å‹çš„å¯¹è±¡ã€‚å®ƒçš„å†…å®¹åŒ…å«äº† `Readme.md` è¿™ä¸ªæ–‡ä»¶çš„åç§°ï¼Œå¯¹åº”çš„ git blob å¯¹è±¡çš„ SHA-1 hash å’Œæ–‡ä»¶æ¨¡å¼ï¼ˆ100644ï¼‰ã€‚

è¿™æ—¶æˆ‘ä»¬çš„å‡ ä¸ª git å¯¹è±¡ä¹‹é—´çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼š

![](../images/commit-1.png)

éšåæˆ‘ä»¬åœ¨ `src/index.js` ä¸­ç¼–å†™ä¸€æ®µä»£ç ï¼Œå¹¶æäº¤ï¼š

```js
// index.js
console.log('this is index.js')
// TODO
```

```sh
$ git add src/index.js
$ git commit -m 'init project index'
```

è¿™æ—¶å€™æˆ‘ä»¬å†çœ‹ `.git/objects`ï¼š

```sh
$ tree .git/objects
.git/objects
â”œâ”€â”€ 12
â”‚Â Â  â””â”€â”€ 0c03e073cdf409403224c406fdfb022a63e750
â”œâ”€â”€ 49
â”‚Â Â  â””â”€â”€ 0e706c59461270e6f3c0d47356ac84e8c0bc1b
â”œâ”€â”€ 8f
â”‚Â Â  â””â”€â”€ d15dbfbba5fd5b981de38f5177c8029693f4fb
â”œâ”€â”€ bd
â”‚Â Â  â””â”€â”€ acba00da0ef745a2bdfdee7844ecc97db19cb0
â”œâ”€â”€ e0
â”‚Â Â  â””â”€â”€ 5e71a0142e288df830343f06c2e9549511b159
â”œâ”€â”€ ed
â”‚Â Â  â””â”€â”€ afe27e250ef26f694b25afce81bdaf96f44eb0
â”œâ”€â”€ ff
â”‚Â Â  â””â”€â”€ cee3ab51c6a5903bc8a9ca9378a5672e44ea36
â”œâ”€â”€ info
â””â”€â”€ pack

9 directories, 7 files
```

å””ï¼Œæœ‰ç‚¹å¤šå“ˆã€‚æˆ‘ä»¬å…ˆæ’é™¤æ‰ä¸Šä¸€æ¬¡æäº¤ä¸­æ¶‰åŠçš„3ä¸ª git å¯¹è±¡ï¼š`120c0...`, `490e7...` å’Œ `edafe...`ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±è¿˜æœ‰4ä¸ªå¯¹è±¡ã€‚é€ä¸€åˆ†æå¯ä»¥å¾—åˆ°ï¼š

* `8fd15...` - `commit` å¯¹è±¡ï¼Œå†…å®¹ä¸ºï¼š
  * **tree** `e05e7...`
  * **parent** `120c0...`
  * **author** `Zeqiu Wu`
  * **committer** `Zeqiu Wu`
  * **commit ä¿¡æ¯** `init project index`
* `bdacb...` - `blob` å¯¹è±¡ï¼Œå†…å®¹ä¸ºåˆšæ‰æˆ‘ä»¬å†™å…¥çš„ä¸‰è¡Œ JS è„šæœ¬
* `e05e7...` - `tree` å¯¹è±¡ï¼Œå†…å®¹ä¸ºï¼š
  * `100644` `blob` `edafe...` `Readme.md`
  * `040000` `tree` `ffcee...` `src`
* `ffcee...` - `tree` å¯¹è±¡ï¼Œå†…å®¹ä¸ºï¼š
  * `100644` `blob` `bdacb...` `index.js`

ç”¨å›¾æ¥è¡¨ç¤ºä¼šæ›´ç›´è§‚ä¸€äº›ï¼š

![](../images/commit-2.jpg)

ç¬¬äºŒä¸ª commit çš„å›¾ä¸­ï¼ŒåŒ…å«äº†å¾ˆå¤šä¿¡æ¯ã€‚

é¦–å…ˆï¼Œç›¸æ¯”äºä¸Šä¸€ä¸ªå›¾ï¼Œä¸éš¾ç•™æ„åˆ° `490e7...` è¿™ä¸ª tree å¯¹è±¡çš„å†…å®¹ä¸­ï¼Œé™¤äº†åŒ…å«å¯¹ blob å¯¹è±¡çš„å¼•ç”¨å¤–ï¼Œè¿˜åŒ…å«å¯¹å¦ä¸€ä¸ª tree å¯¹è±¡çš„å¼•ç”¨ï¼š`ffcee...`ï¼Œä¸”å¼•ç”¨ä¸­æ³¨æ˜äº† `src` è¿™ä¸ªæ–‡ä»¶å¤¹åç§°ã€‚

ä»æ¦‚å¿µä¸Šè®²ï¼Œä»é¡¹ç›®é¡¶å±‚ç›®å½•å¼€å§‹ï¼Œgit å‚¨å­˜çš„å®é™…æ•°æ®ç»“æ„æœ‰ç‚¹åƒè¿™æ ·ï¼š

![](https://git-scm.com/book/en/v2/images/data-model-1.png)

åœ¨æœ€é¡¶ç«¯æ€»ä¼šæœ‰ä¸€ä¸ª `tree` å¯¹è±¡ï¼›å¦‚é¡¶å±‚ç›®å½•ä¸‹è¿˜æœ‰åˆ«çš„æ–‡ä»¶å¤¹ï¼Œåˆ™å°±æ–‡ä»¶å¤¹æœ¬èº«ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„ `tree` å¯¹è±¡è®°å½•ã€‚

å¦å¤–ï¼Œåœ¨ä¸Šä¸€ä¸ª commit ä¸­å‡ºç°çš„ `Readme.md` ä»ç„¶å‡ºç°åœ¨å›¾ä¸­ï¼Œåªæ˜¯è¿™æ¬¡æ˜¯ä¸€ä¸ªåä¸º `490e7...` çš„ tree å¯¹è±¡è®°å½•äº† `Readme.md` çš„ blob å¯¹è±¡çš„ hashã€‚

æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯ `a1a6b...` è¿™ä¸ª commit å¯¹è±¡ï¼Œé™¤äº†åŒ…å« tree å¼•ç”¨ï¼Œæäº¤è€…ä¿¡æ¯å’Œ commit æ—¥å¿—å¤–ï¼Œè¿˜é™„å¸¦äº†ä¸€ä¸ª `parent` ä¿¡æ¯ï¼Œæ­£å¥½æ˜¯ä¸Šä¸€ä¸ª commit çš„ SHA-1 hash `56319...`

å¦‚æœæˆ‘ä»¬å°† `.git/objects` é‡Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ”¾åˆ°ä¸€ä¸ªå›¾ä¸­ï¼Œå°±ä¼šæ˜¯è¿™æ ·çš„ï¼š

![](../images/all-git-objects.jpg)

å…¶ä¸­çš„å¯¹è±¡é—´çš„å…³ç³»ï¼Œå¤§å®¶å¯ä»¥å°è¯•è‡ªå·±ä½“ä¼š :p

### git å¯¹è±¡å°ç»“

ä»ä¸Šä¸€èŠ‚çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›åŸºæœ¬çš„ç»“è®ºï¼š

* git é€šè¿‡åœ¨ã€Œç‰ˆæœ¬åº“ã€ï¼ˆå³ `.git/objects`ï¼‰ä¸­åˆ›å»ºä¸€ä¸ªè·¯å¾„å”¯ä¸€çš„æ–‡ä»¶æ¥è®°å½•ï¼ˆæˆ–è€…å«â€è·Ÿè¸ªâ€œï¼‰ä¸€ä¸ª git å¯¹è±¡ã€‚è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„ç”±ä¸€ä¸ªé•¿åº¦ä¸º 40 çš„ SHA-1 hash åˆ†æ‹†ç»„æˆã€‚
* æˆ‘ä»¬çŸ¥é“æœ‰ä¸‰ç§ git å¯¹è±¡ï¼šblob, tree, commitï¼ˆæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œç ”ç©¶ tag å¯¹è±¡ï¼‰
* blob å¯¹è±¡å¯¹åº”æŸä¸ªæ–‡ä»¶åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å†…å®¹ã€‚
* commit å’Œ tree å¯¹è±¡çš„æ•°æ®ä¸­ä¼šåŒ…å«å¯¹ tree æˆ– blob å¯¹è±¡çš„æŒ‡é’ˆ
* tree å¯¹è±¡å¯ä»¥è§†ä½œä»£è¡¨ â€œæ–‡ä»¶å¤¹â€ â€”â€” tree å¯¹è±¡çš„æŒ‡å‘å…³ç³»ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¯¹åº”æ–‡ä»¶å¤¹å…³ç³»çš„ä¸€é¢—æ ‘
* ä»ç¬¬äºŒä¸ªå¼€å§‹çš„æ‰€æœ‰ commit å¯¹è±¡ï¼Œéƒ½ä¼šåŒ…å«æŒ‡å‘å…¶ä¸Šä¸€ä¸ª commit çš„æŒ‡é’ˆ

  ![](https://git-scm.com/book/en/v2/images/commits-and-parents.png)

## åˆ†æ”¯çš„ç§˜å¯†

åŸºäº git çš„å¯¹è±¡ç†è®ºï¼Œæˆ‘ä»¬æ¥å°è¯•å‰–æ git åˆ†æ”¯çš„å…·ä½“å½¢æ€ï¼Œä»¥åŠå¯¹åˆ†æ”¯çš„å„ç§æ“ä½œã€‚

### ä»åˆ†å‰åˆ°åˆ†æ”¯

ä»ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“é™¤äº†ç¬¬ä¸€ä¸ª commit å¤–ï¼Œæ¯ä¸ª commit éƒ½ä¼šåŒ…å«å¯¹ä¸Šä¸€ä¸ªçš„æŒ‡é’ˆã€‚é‚£ä¹ˆå‡å¦‚æŸä¸ª git é¡¹ç›®ä¸€ç›´åªæœ‰ä¸€ä¸ªäººåœ¨å¼€å‘ï¼Œé‚£ä¹ˆè¿™ä¸ª git é¡¹ç›®çš„ commit è®°å½•å°±ä¼šç»„æˆ1æ¡ç®€å•çš„ç›´çº¿ã€‚

ä½†å¦‚æœæ˜¯ä¸¤ä¸ªäººåœ¨å¼€å‘ï¼Œå¿…ç„¶ä¼šå‡ºç°å¹¶è¡Œå·¥ä½œçš„æƒ…å†µï¼ˆæ€»ä¸èƒ½ A å…ˆçœ¼å·´å·´ç­‰ç€ B å¼€å‘å®Œå†å¼€å‘å§ï¼‰ï¼Œåœ¨æäº¤å†å²ä¸Šæˆ‘ä»¬å°±ä¼šå‡ºç°åˆ†å‰ã€‚

git æä¾›äº†ã€Œåˆ†æ”¯ã€çš„æ¦‚å¿µæ¥æ”¯æŒç”¨æˆ·è¿›è¡Œåˆ†å‰æ“ä½œã€‚**git çš„åˆ†æ”¯æœ¬è´¨ä¸Šåªæ˜¯æŒ‡å‘ commit å¯¹è±¡çš„å¯å˜æŒ‡é’ˆ**ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†è¯´æ˜è¿™ä¸€ç‚¹ï¼š

åœ¨æˆ‘ä»¬æ–°å»ºä¸€ä¸ªä»“åº“å¹¶å®Œæˆæäº¤ï¼ˆæˆ–è€…ä»è¿œç¨‹åŒæ­¥ä¸€ä¸ªä»“åº“åˆ°æœ¬åœ°ï¼‰æ—¶ï¼Œéƒ½ä¼šå‘ç°å½“å‰å·²ç»å­˜åœ¨ä¸€ä¸ªå«åš `master` çš„åˆ†æ”¯ã€‚è¿™æ˜¯å› ä¸º git é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªåä¸º `master` çš„æŒ‡é’ˆï¼Œå¹¶æŒ‡å‘æœ€è¿‘ä¸€æ¬¡çš„ commit å¯¹è±¡ã€‚åœ¨æ¯æ¬¡ commit åï¼Œ`master` æŒ‡é’ˆä¼šè·Ÿç€ç§»åŠ¨ï¼ŒæŒ‡å‘æ–°ç”Ÿæˆçš„ commit å¯¹è±¡ã€‚è¿™æ—¶å€™çš„çŠ¶æ€å¦‚ä¸‹å›¾ï¼š

![](../images/branch-1.jpg)

æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼š

```sh
$ git branch testing # åœ¨å½“å‰æäº¤å¯¹è±¡ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆ
```

> æ³¨ï¼šgit branch æ“ä½œä¸­ï¼Œgit å®é™…ä¸Šä¼šè¿è¡Œä¸€ä¸ª update-ref æŒ‡ä»¤ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶ã€‚

äºæ˜¯æˆ‘ä»¬å¾—åˆ°è¿™æ ·ä¸€ä¸ªçŠ¶æ€ï¼š

![](https://git-scm.com/book/en/v2/images/two-branches.png)

è¿™é‡Œçš„ `master` å’Œ `testing` éƒ½æŒ‡å‘äº†åŒä¸€ä¸ª commit å¯¹è±¡ï¼Œä¸”æœ¬è´¨ä¸Šè¿™ä¸¤ä¸ªåˆ†æ”¯ï¼ˆæŒ‡é’ˆï¼‰æ˜¯å¹³ç­‰çš„ï¼ˆ`master` åªä¸è¿‡æ˜¯ git é»˜è®¤åˆ†æ”¯çš„åå­—ï¼‰ã€‚é—®é¢˜æ¥äº†ï¼Œå¦‚æœæ¥ä¸‹æ¥æˆ‘ä»¬è¦åšä¸€ä¸ªæ–°çš„æäº¤ï¼Œæ˜¯ä¸¤ä¸ªåˆ†æ”¯éƒ½è·Ÿç€ç§»åŠ¨ä¹ˆï¼Ÿè¿˜æ˜¯åªæœ‰ `master`ï¼Ÿä»€ä¹ˆæ—¶å€™ `testing` ä¼šè·Ÿç€å¾€å‰èµ°å‘¢ï¼Ÿ

è¿™å°±å–å†³äºï¼š**å½“å‰æˆ‘ä»¬ä½¿ç”¨å“ªä¸€ä¸ªæŒ‡é’ˆ**ï¼Œæˆ–è€…è¯´ï¼š**å½“å‰æˆ‘ä»¬åœ¨å“ªä¸ªåˆ†æ”¯ä¸Š**

é‚£æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼šgit å¦‚ä½•çŸ¥é“å½“å‰åœ¨å“ªä¸€ä¸ªåˆ†æ”¯ä¸Šå‘¢ï¼Ÿ

### HEAD

ç­”æ¡ˆæ˜¯ git ä½¿ç”¨äº†åä¸º `HEAD` çš„ç‰¹æ®ŠæŒ‡é’ˆã€‚git ä»“åº“çš„ **å½“å‰æ–‡ä»¶** çš„çŠ¶æ€ï¼Œæ€»æ˜¯å¯¹åº” `HEAD` æŒ‡é’ˆæ‰€æŒ‡å‘çš„æäº¤å¯¹è±¡å¯¹åº”çš„å¿«ç…§ã€‚

![](https://git-scm.com/book/en/v2/images/head-to-master.png)

é€šè¿‡ `git status` æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰æˆ‘ä»¬è¿˜æ˜¯åœ¨ `master` åˆ†æ”¯ä¸Šï¼ˆå°½ç®¡æˆ‘ä»¬å·²ç»åˆ›å»ºäº† `testing` åˆ†æ”¯ï¼‰ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸‹å„ä¸ªåˆ†æ”¯æŒ‡å‘çš„å¯¹è±¡ï¼Œè¿™å’Œä¸Šé¢çš„å›¾ä¾‹ç»“æœæ˜¯å»åˆçš„ï¼š

```sh
$ git log --oneline --decorate
f30ab (HEAD, master, testing) add feature #32 - ability to add new
34ac2 fixed bug #1328 - stack overflow under certain conditions
98ca9 initial commit of my project
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `checkout` æŒ‡ä»¤è®© `HEAD` æŒ‡é’ˆä»æŒ‡å‘ `master` æ”¹æˆæŒ‡å‘ `testing`ï¼š

```sh
$ git checkout testing
Switched to branch 'testing'
```

è¿™æ—¶ `HEAD` æŒ‡å‘ `testing` åˆ†æ”¯ã€‚

![](https://git-scm.com/book/en/v2/images/head-to-testing.png)

> æ³¨æ„, è¿™é‡Œä¸è¦å’Œ SVN çš„ checkout ææ··äº†, å®ƒä»¬å®Œå…¨ä¸åŒ

è¿™æ—¶å¦‚æœæˆ‘ä»¬å†åšä¸€ä¸ªæ–°çš„ commitï¼Œåˆ™ `testing` åˆ†æ”¯ï¼ˆæŒ‡é’ˆï¼‰å°†è·Ÿç€å¾€å‰ï¼ŒæŒ‡å‘æ–°çš„ commitï¼ŒåŒæ—¶ `HEAD` ä¹Ÿä¼šè‡ªè§‰åœ°è·Ÿç€æ–°çš„ commitï¼š

![](https://git-scm.com/book/en/v2/images/advance-testing.png)

ç„¶åæˆ‘ä»¬å¯ä»¥å†è®© `HEAD` æŒ‡å‘ `master`ï¼š

```sh
$ git checkout master
Switched to branch 'master'
```

![](https://git-scm.com/book/en/v2/images/checkout-master.png)

æœ€åæˆ‘ä»¬åˆåšä¸€ä¸ª commitï¼Œè®©åˆ†å‰å‡ºç°ï¼Œå“¦è±ï¼

![](https://git-scm.com/book/en/v2/images/advance-master.png)

### refs, refs!

æˆ‘ä»¬ç°åœ¨çŸ¥é“ HEAD æ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰åˆ†æ”¯ï¼ˆå³ä¸€ç³»åˆ— commit é“¾æ¡ä¸Šçš„æœ€åä¸€ä¸ªï¼‰çš„æŒ‡é’ˆï¼Œä¹ŸçŸ¥é“ `master` å’Œ `testing` ä¹Ÿæ˜¯æŒ‡å‘æœ€åä¸€ä¸ª commit çš„æŒ‡é’ˆã€‚é‚£å®ƒä»¬å…·ä½“çš„å­˜åœ¨å½¢å¼æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ

æˆ‘ä»¬å…ˆä» HEAD å¼€å§‹ç ”ç©¶ã€‚è®©æˆ‘ä»¬å†çœ‹ä¸€æ¬¡ `.git` æ–‡ä»¶å¤¹çš„ç»“æ„ï¼š

```sh
.git
â”œâ”€â”€ HEAD
â”œâ”€â”€ config
â”œâ”€â”€ description
â”œâ”€â”€ hooks (è‹¥å¹²ä¸ª git hook æ–‡ä»¶, æ­¤å¤„çœç•¥)
â”œâ”€â”€ info (æš‚æ—¶çœç•¥)
â”œâ”€â”€ objects (git åŸå§‹å¯¹è±¡å­˜æ”¾åœ°ç‚¹, çœç•¥)
â””â”€â”€ refs
    â”œâ”€â”€ heads
    â””â”€â”€ tags
```

æˆ‘ä»¬ç•™æ„åˆ°æ°å¥½æœ‰ä¸€ä¸ªåä¸º HEAD çš„æ–‡ä»¶ã€‚æŸ¥çœ‹å®ƒçš„å†…å®¹ï¼š

```sh
$ cat .git/HEAD
ref: refs/heads/master
```

æˆ‘ä»¬å‘ç° HEAD æ–‡ä»¶ä¸­æåˆ°äº† `refs/heads/master`ã€‚è®©æˆ‘ä»¬æ¥è¯•ä¸‹åˆ‡æ¢åˆ†æ”¯åˆ° testingï¼Œæ›´æ”¹ HEAD çš„æŒ‡å‘ï¼š

```sh
$ git checkout testing
$ cat .git/HEAD
ref: refs/heads/testing
```

è§‚å¯Ÿ `refs/heads` ç›®å½•ï¼š

```sh
$ ls .git/refs/head/
master  testing

$ cat .git/refs/head/master
a1a6b4ff321bb2c058632a231fce0e56ab2ab3f3

$ cat .git/refs/head/testing
a1a6b4ff321bb2c058632a231fce0e56ab2ab3f3
```

å¦‚æœè¿™æ—¶æˆ‘ä»¬å¸Œæœ›å†åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ `feat-abc`ï¼Œå¯ä»¥åˆ©ç”¨ä¸Šæ–‡æåŠçš„ `git branch` æŒ‡ä»¤ã€‚è¿™æ—¶å€™ git ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆ abcï¼Œè¿™ä¸ª abc æŒ‡å‘çš„æœ€åä¸€ä¸ª commit å’Œ testing ä¸€æ ·ï¼š

```sh
$ git branch abc

$ ls .git/refs/head
master  testing  abc

$ cat .git/refs/head/abc # æ³¨æ„è§‚å¯Ÿè¾“å‡ºçš„ SHA-1 å€¼, å’Œä¸Šä¸€æ®µä¾‹å­ä¸­ refs/head/testing ä¸€æ ·
a1a6b4ff321bb2c058632a231fce0e56ab2ab3f3

$ git checkout abc # åˆ‡æ¢å½“å‰åˆ†æ”¯åˆ° abc, å³è®© HEAD çš„å€¼ä¸º refs/head/abc
```

å¦‚æœè¿™æ—¶å€™æˆ‘ä»¬å†å®Œæˆä¸€ä¸ªæ–°çš„ commitï¼Œåˆ™å½“å‰çš„åˆ†æ”¯åº”ç”¨ abc æ‰€æŒ‡å‘çš„ commit çš„å€¼è‡ªç„¶ä¼šå‘ç”Ÿæ”¹å˜ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­çš„è¿‡ç¨‹äº†ã€‚

å¯ä»¥å‘ç°ï¼š`.git/refs/head` ä¸‹å­˜æ”¾çš„æ–‡ä»¶ï¼Œå°±æ˜¯å¯¹åº”ç€å„ä¸ªç°æœ‰çš„åˆ†æ”¯ï¼›ä¸”è¿™äº›æ–‡ä»¶çš„å†…å®¹å°±æ˜¯å…¶æŒ‡å‘çš„ commit çš„ SHA-1 hash å€¼ã€‚

**åƒ HEAD å’Œ refs/head/abc è¿™æ ·çš„æ–‡ä»¶ï¼Œåœ¨ git ä¸­å¯ä»¥ç»Ÿç§°ä¸ºå¼•ç”¨ï¼ˆreferences, æˆ–ç¼©å†™ä¸º refsï¼‰**

å¼•ç”¨å¯ä»¥åˆ†ä¸ºå‡ ç§ï¼šHEAD å¼•ç”¨ï¼Œåˆ†æ”¯å¼•ç”¨ï¼Œæ ‡ç­¾å¼•ç”¨ï¼ˆtag referenceï¼‰å’Œè¿œç¨‹å¼•ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬ä¸å¯¹æ ‡ç­¾å¼•ç”¨åšè¿‡å¤šçš„è§£é‡Šï¼ˆæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥é˜…èµ„æ–™ï¼‰ï¼Œä»…å¯¹å…¶ä»–å‡ ç§è¿›è¡Œè®¨è®ºã€‚

#### HEAD å¼•ç”¨

åœ¨ä¸Šæ–‡ä¾‹å­ä¸­æåˆ°çš„ `.git/HEAD` å°±æ˜¯ HEAD å¼•ç”¨ã€‚å®ƒæ˜¯ä¸€ä¸ªç¬¦å·å¼•ç”¨ï¼ˆsymbolic referenceï¼‰ï¼ŒæŒ‡å‘ç›®å‰æ‰€åœ¨çš„åˆ†æ”¯ã€‚

æ‰€è°“ç¬¦å·å¼•ç”¨æ˜¯æŒ‡å®ƒæœ¬èº«ä¸åŒ…å«ä¸€ä¸ª SHA-1 hashï¼Œè€Œæ˜¯æŒ‡å‘äº†å…¶ä»–çš„åˆ†æ”¯å¼•ç”¨ã€‚å¦‚ä¹‹å‰çš„ä¾‹å­æ‰€ç¤ºï¼Œå¦‚æœæ‰§è¡Œ `git checkout testing`ï¼Œgit ä¼šå°† HEAD çš„å€¼è®¾ä¸º `ref: refs/heads/testing`

> æ³¨ï¼šå…¶å® HEAD ä¹Ÿä¸æ˜¯å¿…é¡»æŒ‡å‘åˆ«çš„å¼•ç”¨ï¼Œå®ƒä¹Ÿæ˜¯å¯ä»¥åƒæ™®é€šå¼•ç”¨ä¸€æ ·åŒ…å«ä¸€ä¸ªå…·ä½“çš„ commit SHA-1 hashï¼Œè¿™æ ·çš„ HEAD è¢«ç§°ä¸º detached HEAD

> æ³¨2ï¼šcheckout æŒ‡ä»¤åº•å±‚æ‰€ä¾èµ–çš„å‘½ä»¤ä¸º symbolic-refï¼Œæœ‰å…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶ã€‚

#### åˆ†æ”¯å¼•ç”¨

åœ¨ä¸Šæ–‡ä¾‹å­ä¸­æåˆ°çš„ `.git/refs/xxx` å°±æ˜¯æ‰€è°“çš„ã€Œåˆ†æ”¯å¼•ç”¨ã€ï¼Œå®ƒä»¬çš„ä¸»è¦ä½œç”¨æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿç”¨å¯ç†è§£çš„ä»£å·ï¼Œæ¥æŒ‡å‘æŸä¸€ä¸ªç‰¹æ®Šçš„ commitï¼Œä¸”å…è®¸æˆ‘ä»¬åœ¨è¿™ä¸ª commit çš„åŸºç¡€ä¸Šè¿›è¡Œæ–°çš„å¼€å‘ï¼ˆæäº¤ commitï¼‰

#### è¿œç¨‹å¼•ç”¨

åœ¨å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯ä»æŸä¸ªå¯è®¿é—®çš„åœ°å€è·å–æŸä¸ªé¡¹ç›®çš„å·²æœ‰ä»£ç ï¼Œè¿™ä¸ªå¯è®¿é—®çš„åœ°å€è¢«ç§°ä¸ºè¿œç¨‹ä»“åº“ã€‚ã€Œè¿œç¨‹å¼•ç”¨ã€æ­£æ˜¯æŒ‡å‘è¿œç¨‹ä»“åº“æŸä¸ªåˆ†æ”¯çš„å¼•ç”¨ã€‚

ã€Œè¿œç¨‹å¼•ç”¨ã€æ˜¯åªè¯»çš„ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬è®°å½•å·²çŸ¥çš„è¿œç¨‹ä»“åº“ä¸Šï¼Œå„ä¸ªåˆ†æ”¯å’Œæ ‡ç­¾çš„çŠ¶æ€ã€‚å½“ç„¶ï¼Œå¦‚æœå®é™…ä¸Šè¿œç¨‹ä»“åº“å‘ç”Ÿäº†å˜åŒ–ï¼Œæœ¬åœ°çš„ã€Œè¿œç¨‹å¼•ç”¨ã€ä¸ä¼šè‡ªåŠ¨åœ°è·Ÿè¸ªï¼›åŒæ ·ï¼Œæœ¬åœ°ä¹Ÿä¸å¯ä»¥ç›´æ¥ä¿®æ”¹ã€Œè¿œç¨‹åº”ç”¨ã€æ‰€æŒ‡å‘çš„åˆ†æ”¯ã€‚å½“æˆ‘ä»¬åšä»»ä½•ç½‘ç»œé€šä¿¡æ“ä½œæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç§»åŠ¨ã€‚å®ƒå°±åƒæ˜¯ä½ ä¸Šæ¬¡è¿æ¥åˆ°è¿œç¨‹ä»“åº“æ—¶ï¼Œé‚£äº›åˆ†æ”¯æ‰€å¤„çŠ¶æ€çš„ä¹¦ç­¾ã€‚æˆ‘ä»¬ç§°ã€Œè¿œç¨‹å¼•ç”¨ã€æ‰€æŒ‡å‘çš„è¿œç¨‹ä»“åº“ä¸­çš„åˆ†æ”¯ä¸ºã€Œè¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ã€ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `git ls-remote (remote)` æˆ–è€… `git ls -r` æ¥æ˜¾å¼è·å–è¿œç¨‹å¼•ç”¨çš„å®Œæ•´åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŸ¥çœ‹ `refs/remotes` ä¸‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š

```sh
$ ls .git/refs/remotes # åˆ—ä¸¾æ‰€æœ‰å·²çŸ¥çš„è¿œç¨‹ä»“åº“ 
origin
$ ls .git/refs/remotes/origin # åˆ—ä¸¾ origin ä¸‹å·²çŸ¥çš„å¼•ç”¨(åˆ†æ”¯)
master feat-abc
$ cat .git/refs/remotes/origin/master # æŸ¥çœ‹è¿œç¨‹ä»“åº“ origin ä¸‹ master åˆ†æ”¯æŒ‡å‘çš„ commit
....
```

ç”±äº git æœ¬åœ°ä¸ä¼šè‡ªåŠ¨è·Ÿè¸ªè¿œç¨‹ä»“åº“çš„ä»»ä½•å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°æ›´æ–°è¿œç¨‹ä»“åº“çš„çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ `git fetch` æ¥æ›´æ–°è¿œç¨‹ä»“åº“ä¸Šå„ä¸ªåˆ†æ”¯çš„æœ€æ–°çŠ¶æ€ã€‚è¿™é‡Œæœ¬è´¨ä¸Šæ˜¯å°†è¿œç¨‹ä»“åº“ä¸Šå„ä¸ªåˆ†æ”¯çš„æœ€æ–°ä»£ç å˜æ›´æ‹‰å–åˆ°æœ¬åœ°ã€‚

ç”±äºå®ƒå®é™…ä¸Šç¡®å®æ˜¯ä¸€ä¸ªæœ¬åœ°å¯è®¿é—®çš„åˆ†æ”¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒåˆå¹¶åˆ°æœ¬åœ°çš„æŸä¸ªåˆ†æ”¯ä¸Šï¼Œæ¯”å¦‚å½“å‰æˆ‘ä»¬ä½äº `master` åˆ†æ”¯ï¼Œå¸Œæœ›å°†åä¸º origin çš„è¿œç¨‹ä»“åº“ä¸Šæœ€æ–°çš„ master åˆ†æ”¯ åˆå¹¶è¿›æ¥ï¼›é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ï¼š

```sh
$ git checkout master       # åˆ‡æ¢åˆ° master åˆ†æ”¯
$ git fetch origin          # æ›´æ–° origin ä¸‹çš„æ‰€æœ‰åˆ†æ”¯
$ git merge origin/master   # åˆå¹¶æ“ä½œ
```

æ›´ç®€å•çš„æ–¹æ³•æ˜¯ï¼šæˆ‘ä»¬åœ¨ `master` åˆ†æ”¯ä¸Šç›´æ¥æ‰§è¡Œ `git pull origin master`ï¼Œgit ä¼šè‡ªåŠ¨è¯†åˆ«å»å“ªä¸ªæœåŠ¡å™¨ä¸ŠæŠ“å–åˆå¹¶ï¼š`git pull origin master` => `git fetch origin` + `git merge origin/master`

å› ä¸ºè¿™æ ·çš„æ“ä½œéå¸¸é«˜é¢‘ï¼Œæ‰€ä»¥ git å…è®¸æˆ‘ä»¬åˆ›å»ºæ‰€è°“çš„ **è·Ÿè¸ªåˆ†æ”¯ï¼ˆtracking-branchï¼‰** æ¥ç®€åŒ–åŒæ­¥ä»£ç çš„æ“ä½œï¼šæˆ‘ä»¬åªéœ€è¦ä»ä¸€ä¸ªã€Œè¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ã€ä¸­ checkout å‡ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œgit å°±ä¼šè®¤ä¸ºè¿™ä¸ªæ–°çš„åˆ†æ”¯ â€œè·Ÿè¸ªâ€ äº†è¿œç¨‹ä»“åº“ä¸­å¯¹åº”çš„åˆ†æ”¯ï¼š

```sh
$ git checkout origin/abc
$ git checkout -b abc
## æˆ–è€…å¯ä»¥è¿™æ ·
$ git checkout --track origin/abc # åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªåŒåçš„ abc åˆ†æ”¯, ä½œä¸º "è·Ÿè¸ªåˆ†æ”¯"
```

åœ¨ã€Œè·Ÿè¸ªåˆ†æ”¯ã€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ `git pull` è€Œä¸éœ€è¦æŒ‡å®šå¯¹åº”çš„è¿œç¨‹ä»“åº“å’Œåˆ†æ”¯åç§°ï¼›åƒå¤§å®¶å¸¸è§çš„ `git clone` æ“ä½œï¼Œå®é™…ä¸Šå°±ä¼šå°† `master` åˆ†æ”¯è®¾ç½®ä¸º `origin/master` åˆ†æ”¯çš„ã€Œè·Ÿè¸ªåˆ†æ”¯ã€ã€‚

åˆšæ‰æˆ‘ä»¬ç®€å•æåˆ°äº†åˆ†æ”¯é—´çš„ merge æ“ä½œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æ git åˆ†æ”¯é—´çš„åˆå¹¶æ“ä½œã€‚
 
### åˆ†æ”¯çš„åˆå¹¶

åœ¨çœŸå®çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ†æ”¯ï¼Œæ˜¯ä¸ºäº†å¯ä»¥å°†æ–°åŠŸèƒ½æˆ–è€…æ¨¡å—çš„å¼€å‘ï¼Œæ‹†åˆ†åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ä¸æ–­åœ° commit ä¿å­˜ä¸€äº›è¿‡ç¨‹ä¸­çš„å°åŠŸèƒ½ç‚¹ï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒè¿™äº› commit ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿå¯ç”¨çš„éƒ¨åˆ†ï¼ˆé€šå¸¸æ¥è¯´ï¼ŒæŒ‡ masterï¼‰

è®©æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªå›¾ï¼š

![](https://git-scm.com/book/en/v2/images/basic-branching-4.png)

æˆ‘ä»¬å¯ä»¥æƒ³è±¡æœ‰è¿™æ ·çš„äº‹æƒ…ï¼š

* æˆ‘ä»¬å‡†å¤‡å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä» `master` åˆ†æ”¯ä¸Šå»ºç«‹äº†ä¸€ä¸ªåˆ†æ”¯ `iss53`ï¼Œå¹¶è®© HEAD æŒ‡å‘è¿™ä¸ªåˆ†æ”¯ï¼ˆå…¶å®å°±æ˜¯ `checkout`ï¼‰
* ç„¶åæˆ‘ä»¬åœ¨ `iss53` ä¸Šåšäº†ä¸€ä¸ª commit `C3`
* éšåè€æ¿ ~~ï¼ˆå¾ˆç”Ÿæ°”åœ°ï¼‰~~ å‘Šè¯‰æˆ‘ä»¬ï¼Œçº¿ä¸Šæœ‰ä¸€ä¸ª bugï¼Œè¦å°½å¿«ä¿®å¤å®ƒï¼›äºæ˜¯æˆ‘ä»¬åˆ‡æ¢å› `master` åˆ†æ”¯ï¼Œç„¶ååœ¨ `master` åˆ†æ”¯ä¸Šé‡æ–°å»ºç«‹ä¸€ä¸ªå«åš `hotfix` çš„åˆ†æ”¯ï¼Œç„¶ååœ¨ä¸Šé¢åšäº†ä¸€ä¸ª `C4` çš„ commitï¼Œåº”è¯¥å¯ä»¥ä¿®å¤è¿™ä¸ªç´§æ€¥é—®é¢˜ã€‚

å¥½äº†ï¼Œæ¥ä¸‹æ¥è¯¥å¹²å˜›ï¼Ÿâ€”â€” æˆ‘ä»¬åº”è¯¥æƒ³åŠæ³•æŠŠ `hotfix` ä¸Šçš„å†…å®¹åˆå¹¶åˆ°åŸæ¥çš„ `master` åˆ†æ”¯ä¸Šã€‚

è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸Š `git merge` è¿™ä¸ªåŠŸèƒ½äº†ï¼š

```sh
$ git checkout master # è®© HEAD æŒ‡å‘ master
$ git merge hotfix    # å°† hotfix çš„å†…å®¹åˆå¹¶åˆ° master åˆ†æ”¯ä¸Š
Updating f42c576..3a0874c
Fast-forward
 index.html | 2 ++
 1 file changed, 2 insertions(+)
```

è¿™æ ·çš„åˆå¹¶å±äºã€Œå¿«è¿›ã€ï¼ˆfast-forwardï¼‰â€”â€” ç”±äº `master` åˆ†æ”¯æŒ‡å‘çš„æäº¤æ˜¯å½“å‰ `hotfix` çš„æäº¤çš„ç›´æ¥ä¸Šæ¸¸ï¼Œæ‰€ä»¥ git åªæ˜¯ç®€å•çš„å°† `master` çš„æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚

> æ¢å¥è¯è¯´ï¼Œå½“ä½ è¯•å›¾åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯æ—¶ï¼Œå¦‚æœé¡ºç€ä¸€ä¸ªåˆ†æ”¯èµ°ä¸‹å»èƒ½å¤Ÿåˆ°è¾¾å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆ git åœ¨åˆå¹¶ä¸¤è€…çš„æ—¶å€™ï¼Œåªä¼šç®€å•çš„å°†æŒ‡é’ˆå‘å‰æ¨è¿›ï¼ˆæŒ‡é’ˆå³ç§»ï¼‰ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹çš„åˆå¹¶æ“ä½œæ²¡æœ‰éœ€è¦è§£å†³çš„åˆ†æ­§â€”â€”è¿™å°±å«åšã€Œå¿«è¿›ã€ï¼ˆfast-forwardï¼‰ã€‚

å®Œæˆåˆå¹¶åï¼Œæˆ‘ä»¬å¯ä»¥å‘å¸ƒè¿™ä¸ªä¿®å¤ï¼Œç„¶åå¯ä»¥å›å»ç»§ç»­å¼€å‘æ–°åŠŸèƒ½äº†ï¼›è¿™æ—¶å€™ `master` å’Œ `hotfix` éƒ½æŒ‡å‘åŒä¸€ä¸ª commit å¯¹è±¡ã€‚è€Œ `iss53` å¹¶æ²¡æœ‰å˜åŒ–ã€‚

![](https://git-scm.com/book/en/v2/images/basic-branching-5.png)

æˆ‘ä»¬å¯ä»¥æ¸…ç†æ‰ä¸éœ€è¦çš„ `hotfix` åˆ†æ”¯ï¼Œç„¶åç»§ç»­å¹²æ´»ï¼š

```sh
$ git branch -d hotfix # åˆ é™¤åˆ†æ”¯
Deleted branch hotfix (3a0874c).

$ git checkout iss53
Switched to branch "iss53"

# ... do some work
$ git commit -a 'finished issue 53'
[iss53 ad82d7a] finished issue 53
1 file changed, 1 insertion(+)
```

è¿™æ—¶å€™åˆ†æ”¯çš„æƒ…å†µï¼š

![](https://git-scm.com/book/en/v2/images/basic-branching-6.png)

å¼€å‘å¥½äº† â€”â€” ç°åœ¨æˆ‘ä»¬éœ€è¦æŠŠ `iss53` è¿™ä¸ªåˆ†æ”¯åˆå¹¶å› `master` åˆ†æ”¯ã€‚ä½†è¿™æ—¶ä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´äº§ç”Ÿäº†åˆ†å‰ã€‚è¿™æ—¶ git ä¼šä½¿ç”¨ä¸¤ä¸ªåˆ†æ”¯çš„æœ€è¿‘çš„ commit `C4` å’Œ `C5`ï¼Œè¿åŒä¸¤ä¸ªåˆ†æ”¯çš„å…¬å…±ç¥–å…ˆ `C2` ä¸€èµ·åšä¸€ä¸ªä¸‰æ–¹åˆå¹¶ï¼š

```sh
$ git checkout master
Switched to branch 'master'
$ git merge iss53
Merge made by the 'recursive' strategy.
index.html |    1 +
1 file changed, 1 insertion(+)
```

åˆå¹¶ç»“æŸåï¼Œgit ä¼šç”¨ä¸‰æ–¹åˆå¹¶çš„ç»“æœåˆ›å»ºä¸€ä¸ªæ–°çš„ commit è®°å½•ä¸‹æ¥ã€‚è¿™ä¸ª commit è¢«ç§°ä¸º `merge commit`ï¼Œå®ƒçš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒæœ‰ä¸æ­¢ä¸€ä¸ªçˆ¶ commitï¼š

![](https://git-scm.com/book/en/v2/images/basic-merging-2.png)

è¿™æ ·å·¥ä½œå°±ç»“æŸäº†ï¼Œæ‰€æœ‰çš„ä¿®å¤ï¼Œè¿åŒåŠŸèƒ½ä»£ç éƒ½è¢«åŠ åˆ°äº† master é‡Œé¢ï¼Œæ˜¯æ—¶å€™ä¸‹ç­äº†~~

#### Merge Conflict

ä½†äº‹æƒ…å¹¶æ²¡æœ‰è¿™ä¹ˆé¡ºåˆ©ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°æ— æ³•å¤„ç†åˆå¹¶çš„æƒ…å†µã€‚æ¯”å¦‚è¯´ï¼Œå‡è®¾åˆšæ‰æˆ‘ä»¬åœ¨ `iss53` å’Œ `hotfix` çš„ä¿®æ”¹ä¸­ï¼ŒåŒæ—¶æ¶‰åŠäº†ä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€å¤„ï¼Œå½“åˆå¹¶çš„æ—¶å€™å°±ä¼šäº§ç”Ÿä¸€ä¸ªå†²çªï¼ˆconflictï¼‰ï¼š

```sh
$ git merge iss53
Auto-merging index.html
CONFLICT (content): Merge conflict in index.html
Automatic merge failed; fix conflicts and then commit the result.
```

> åŸåˆ™ä¸Šï¼Œgit ä¼šå°½é‡è‡ªåŠ¨åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯å¯¹ä¸€ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ã€‚

å½“äº§ç”Ÿä¸€ä¸ªå†²çªæ—¶ï¼Œgit ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª merge commitï¼Œè€Œæ˜¯ä¼šæš‚åœä¸‹æ¥ï¼Œç­‰å¾…ä½ å»è§£å†³åˆå¹¶äº§ç”Ÿçš„å†²çªã€‚å¯ä»¥ç”¨ `git status` æ¥æŸ¥çœ‹ï¼š

```sh
$ git status
On branch master
You have unmerged paths.
  (fix conflicts and run "git commit")

Unmerged paths:
  (use "git add <file>..." to mark resolution)

    both modified:      index.html

no changes added to commit (use "git add" and/or "git commit -a")
```

è¿™æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è§£å†³ä»£ç å†²çªã€‚å‡ºç°å†²çªçš„æ–‡ä»¶ä¼šåŒ…å«ä¸€äº›ç‰¹æ®ŠåŒºæ®µï¼Œç±»ä¼¼è¿™æ ·ï¼š

![](../images/git-merge-conflict-example.jpg)

git å°†å†²çªçš„åŒæ–¹å¯¹è¯¥æ–‡ä»¶çš„ä¿®æ”¹ï¼Œéƒ½ä¿ç•™åœ¨ç•Œé¢ä¸Šï¼Œç”¨ `=========` æ¥åˆ†å‰²ä¸¤éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…éœ€è¦ï¼Œé€‰æ‹©å…¶ä¸­çš„æŸä¸ªéƒ¨åˆ†ï¼Œæˆ–è€…è‡ªè¡Œåˆå¹¶å†…å®¹ã€‚å¾ˆå¤šç¼–è¾‘å™¨ï¼ˆå¦‚ VSCodeï¼‰å’Œ IDEï¼ˆå¦‚ WebStormï¼‰å¯¹å¤„ç†å†²çªæä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å€ŸåŠ©å®ƒä»¬æ¥å¤„ç†ã€‚

> è¿™é‡Œæœ€å¥½çš„æ–¹å¼æ˜¯æ‹‰ä¸Šå¦ä¸€ä¸ªåˆ†æ”¯çš„åŒä¼´ï¼ˆå¦‚æœæœ‰å¤šäººåä½œçš„è¯ï¼‰ä¸€èµ·å®¡æŸ¥è¿™ä¸ª conflictï¼Œè¿™æ ·å¯ä»¥é¿å…å•æ–¹é¢æ“ä½œå¯¹æŸéƒ¨åˆ†çš„ä»£ç é€ æˆæ„æ–™ä¹‹å¤–çš„ä¼¤å®³ã€‚

å½“è§£å†³äº†æ‰€æœ‰å†²çªçš„æ–‡ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ `git status` ç¡®è®¤è¿™ä¸€äº‹å®ï¼š

```sh
$ git status
On branch master
All conflicts fixed but you are still merging.
  (use "git commit" to conclude merge)

Changes to be committed:

    modified:   index.html
```

å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œåˆ™å¯ä»¥ç”¨ `git commit` æ¥å®Œæˆæœ€ç»ˆçš„ merge commitã€‚

> å¦ä¸€ç§æƒ…å†µæ˜¯ï¼šæˆ‘ä»¬å‘ç°å®åœ¨æ˜¯å¤ªéš¾å¤„ç†äº†ï¼Œè¿™æ—¶å¯ä»¥ç›´æ¥ç”¨ `git merge --abort` å–æ¶ˆè¿™æ¬¡åˆå¹¶çš„å°è¯• â€”â€” è¿™ç­‰äºæˆ‘ä»¬ä»æ¥æ²¡æœ‰åšè¿‡åˆå¹¶ã€‚ç„¶åæˆ‘ä»¬å«ä¸€ä¸ªè€å¸æœºæ¥ååŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

## å›åˆ° pack çš„é—®é¢˜

è¯´äº†è¿™ä¹ˆå¤šï¼Œè®©æˆ‘ä»¬å›åˆ°æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼š

> `xxx.pack` æ–‡ä»¶æ˜¯ä»€ä¹ˆä¸œè¥¿? ä¸ºä»€ä¹ˆå®ƒä¼šè¿™ä¹ˆå¤§?

æ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸ªå›ç­”ã€‚

### Packfile

ä¸ºäº†è§£é‡Š packfile çš„ä½œç”¨ï¼Œæˆ‘ä»¬åŸºäº [ä¸¾ä¸€ä¸ªæ —å­](#ä¸¾ä¸€ä¸ªæ —å­) ä¸­çš„ git ä»“åº“ï¼Œåšä¸€äº›æ“ä½œï¼š

é¦–å…ˆæˆ‘ä»¬å‘ä»“åº“æäº¤ä¸€ä¸ªä½“ç§¯è¾ƒå¤§çš„æºæ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬é€‰å– [vue.js](https://vuejs.org) æºä»£ç ä¸­ vdom çš„æ ¸å¿ƒä»£ç  [`patch.js`](https://github.com/vuejs/vue/blob/dev/src/core/vdom/patch.js)ï¼š

```sh
$ curl https://raw.githubusercontent.com/vuejs/vue/dev/src/core/vdom/patch.js > src/patch.js
$ git add src/patch.js
$ git commit -m 'added patch.js'
```

è§‚å¯Ÿ git å¯¹ `patch.js` çš„è®°å½•ï¼š

```sh
$ git cat-file -p master^{tree} # æŸ¥çœ‹å½“å‰ commit è®°å½•ä¸‹å¼•ç”¨çš„ git å¯¹è±¡èŠ‚ç‚¹åˆ—è¡¨
100644 blob edafe27e250ef26f694b25afce81bdaf96f44eb0	Readme.md
040000 tree 8c6b7113372ebc4882180bff942b0ab02439aacc	src

$ git cat-file -p 8c6b7113372ebc4882180bff942b0ab02439aacc # æŸ¥çœ‹ src/ ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ git å¯¹è±¡ä¿¡æ¯
100644 blob bdacba00da0ef745a2bdfdee7844ecc97db19cb0	index.js
100644 blob 2052df913b3f240f0407673b775a554d964cd15a	patch.js

$ git cat-file -s 2052df913b3f240f0407673b775a554d964cd15a # patch.js å¤§å°å¤§æ¦‚æ˜¯ 26.5kb
26565
```

ç°åœ¨æˆ‘ä»¬ç¨å¾®å¯¹ `patch.js` åšä¸€äº›ä¿®æ”¹ï¼š

```sh
$ echo '// appending one testing line' >> src/patch.js
$ git commit -am 'modified patch.js'
[master b823eae] modified patch.js
 1 file changed, 1 insertion(+)
```

é‡æ–°è§‚å¯Ÿ `patch.js`ï¼š

```sh
$ git cat-file -p master^{tree}
100644 blob edafe27e250ef26f694b25afce81bdaf96f44eb0	Readme.md
040000 tree ce9de001b849100b9405720c93fb5e54eac178dc	src

$ git cat-file -p ce9de001b849100b9405720c93fb5e54eac178dc
100644 blob bdacba00da0ef745a2bdfdee7844ecc97db19cb0	index.js
100644 blob aa79e3510892b6213cdd6f84aa321f00abb6eb70	patch.js
```

å¯ä»¥çœ‹åˆ°ï¼Œ`patch.js` å¯¹åº”ä¸€ä¸ªå…¨æ–°çš„ git blob å¯¹è±¡ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä¾¿æˆ‘ä»¬åªæ˜¯å¯¹æ–‡ä»¶åšäº†1è¡Œçš„ä¿®æ”¹ï¼Œgit ä¹Ÿä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶çš„â€œå‰¯æœ¬â€ï¼š

```sh
$ git cat-file -s aa79e3510892b6213cdd6f84aa321f00abb6eb70 # patch.js å¤§å°å‡ ä¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–, ä½†è¿™ä¸ª git å¯¹è±¡å·²ç»æ˜¯ä¸€ä¸ªå…¨æ–°çš„äº†
26595
```

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå¯¹æ–‡ä»¶è¿›è¡Œåå¤çš„ä¿®æ”¹ï¼Œå¦‚æœæ¯æ¬¡ä¿®æ”¹ git éƒ½è¦é‡æ–°ç”Ÿæˆä¸€ä¸ªå‰¯æœ¬ï¼Œé‚£ä»“åº“çš„å®é™…ä½“ç§¯å°†è¿…é€Ÿå¢å¤§ï¼æœ‰æ²¡æœ‰åŠæ³•åªè®°å½•æ¯æ¬¡æäº¤çš„å˜æ›´å†…å®¹ï¼Œè€Œä¸æ˜¯å•çº¯çš„å°†æ•´ä¸ªæ–‡ä»¶çš„çŠ¶æ€å®Œå…¨ä¿ç•™ä¸‹æ¥å‘¢ï¼Ÿ

äº‹å®ä¸Š git æ˜¯å¯ä»¥è¿™ä¹ˆåšçš„ã€‚åˆšæ‰æˆ‘ä»¬çœ‹åˆ°çš„ git å­˜å‚¨å¯¹è±¡æ—¶æ‰€ä½¿ç”¨çš„æ ¼å¼è¢«ç§°ä¸ºâ€œæ¾æ•£ï¼ˆlooseï¼‰â€œå¯¹è±¡æ ¼å¼ã€‚ä½† git ä¼šæ—¶ä¸æ—¶å°†å¤šä¸ªå¯¹è±¡æ‰“åŒ…æˆä¸€ä¸ªç§°ä¸º packfile çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»¥èŠ‚çœç©ºé—´å’Œæé«˜æ•ˆç‡ã€‚å½“ç‰ˆæœ¬åº“ä¸­æœ‰å¤ªå¤šçš„æ¾æ•£å¯¹è±¡æ—¶ï¼Œgit ä¼šåœ¨æˆ‘ä»¬å’Œè¿œç¨‹ä»“åº“è¿›è¡Œé€šä¿¡ï¼ˆæ¨é€æˆ–æ‹‰å–ï¼‰æ—¶è‡ªåŠ¨è¿›è¡Œæ‰“åŒ…æ“ä½œã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `git gc` æŒ‡ä»¤æ‰‹åŠ¨è§¦å‘æ‰“åŒ…è¡Œä¸ºï¼š

```sh
$ git gc
Counting objects: 15, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (12/12), done.
Writing objects: 100% (15/15), done.
Total 15 (delta 1), reused 0 (delta 0)
```

è¿™æ—¶å€™å¦‚æœæˆ‘ä»¬å†è§‚å¯Ÿ git æ•°æ®åº“çš„å¯¹è±¡ï¼Œåˆ™ä¼šå‘ç°æˆ‘ä»¬åœ¨ä¾‹å­ä¸­çœ‹åˆ°çš„å„ä¸ªæ–‡ä»¶çš„å‰¯æœ¬éƒ½æ¶ˆå¤±äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸¤ä¸ªåç¼€åˆ†åˆ«ä¸º `.idx` å’Œ `.pack` çš„æ–‡ä»¶ï¼š

```sh
$ find .git/objects -type f
.git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c34.idx
.git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c34.pack
.git/objects/info/packs
```

åˆ†åˆ«è§‚å¯Ÿè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‘ç°å®ƒä»¬çš„ä½“ç§¯éƒ½å¾ˆå°ï¼š

```sh
$ du -sh .git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c3.pack
8.0K	.git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c34.pack

$ du -sh .git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c3.idx
4.0K	.git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c34.idx
```

è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å°±æ˜¯ packfile å’Œå®ƒçš„ç´¢å¼•ï¼š

* packfile åŒ…å«äº†åˆšæ‰ä»æ–‡ä»¶ç³»ç»Ÿä¸­ç§»é™¤çš„æ‰€æœ‰å¯¹è±¡çš„å†…å®¹
* ç´¢å¼•æ–‡ä»¶åŒ…å«äº†åŒ…æ–‡ä»¶çš„åç§»ä¿¡æ¯

æˆ‘ä»¬é€šè¿‡ç´¢å¼•æ–‡ä»¶å°±å¯ä»¥å¿«é€Ÿå®šä½ä»»æ„ä¸€ä¸ªæŒ‡å®šå¯¹è±¡ã€‚è§‚å¯Ÿæ‰“åŒ…å‰åçš„ä»“åº“å¤§å°ï¼Œæˆ‘ä»¬å‘ç°é€šè¿‡æ‰“åŒ…å¯¹è±¡å‡å°‘äº† 2/3 çš„ç£ç›˜å ç”¨ç©ºé—´ã€‚

git æ˜¯å¦‚ä½•åšåˆ°è¿™ç‚¹çš„ï¼Ÿgit æ‰“åŒ…å¯¹è±¡æ—¶ï¼Œä¼šæŸ¥æ‰¾å‘½ååŠå¤§å°ç›¸è¿‘çš„æ–‡ä»¶ï¼Œå¹¶åªä¿å­˜æ–‡ä»¶ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ `git verify-pack` è¿™ä¸ªåº•å±‚å‘½ä»¤æŸ¥çœ‹å·²æ‰“åŒ…çš„å†…å®¹ï¼š

```sh
git-example-repo on î‚  master âœ git verify-pack -v .git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c34.idx
b823eae6cbbf9c2109ba3bee65ce6dc15768f585 commit 230 159 12
5f84f91f1166877d492f63b85ed7883b442b8bea commit 227 158 171
8fd15dbfbba5fd5b981de38f5177c8029693f4fb commit 231 157 329
120c03e073cdf409403224c406fdfb022a63e750 commit 175 122 486
edafe27e250ef26f694b25afce81bdaf96f44eb0 blob   29 36 608
bdacba00da0ef745a2bdfdee7844ecc97db19cb0 blob   52 54 644
aa79e3510892b6213cdd6f84aa321f00abb6eb70 blob   26595 6886 698
a14f60a7108b2693373c6206270f20078e67cf32 tree   67 78 7584
ce9de001b849100b9405720c93fb5e54eac178dc tree   72 79 7662
9fcd22f080fe51922392d4a8b1ef368c40193b0d tree   67 77 7741
8c6b7113372ebc4882180bff942b0ab02439aacc tree   72 78 7818
2052df913b3f240f0407673b775a554d964cd15a blob   9 20 7896 1 aa79e3510892b6213cdd6f84aa321f00abb6eb70
e05e71a0142e288df830343f06c2e9549511b159 tree   67 78 7916
ffcee3ab51c6a5903bc8a9ca9378a5672e44ea36 tree   36 47 7994
490e706c59461270e6f3c0d47356ac84e8c0bc1b tree   37 48 8041
non delta: 14 objects
chain length = 1: 1 object
.git/objects/pack/pack-fb3f62dbf81ab8480462c2d7edfe36785c090c34.pack: ok
```

è¿™é‡Œçš„è¾“å‡ºå†…å®¹ä¸­ï¼Œç¬¬3åˆ—å°±æ˜¯ git æ‰“åŒ…åå¯¹è±¡çš„ä½“ç§¯å¤§å°ã€‚æˆ‘ä»¬å¯ä»¥ç•™æ„ä¸‹å…³äº `patch.js` çš„ä¸¤ä¸ª blob å¯¹è±¡çš„è®°å½•ï¼ˆè¯»è€…å¯ä»¥å‘ä¸Šå¯¹ç…§ä¸‹ SHA-1 hash å€¼ï¼‰ï¼š

```
aa79e3510892b6213cdd6f84aa321f00abb6eb70 blob   26595 6886 698
2052df913b3f240f0407673b775a554d964cd15a blob   9 20 7896 1 aa79e3510892b6213cdd6f84aa321f00abb6eb70
```

å…¶ä¸­ç¬¬1è¡Œæ˜¯ `patch.js` ç¬¬2ä¸ªå‰¯æœ¬çš„è®°å½•ï¼Œæ–‡ä»¶å¤§å°æ²¡æœ‰å˜åŒ–ï¼›è€Œç¬¬2è¡Œä¸­æŒ‡å‘ `patch.js` çš„æœ€æ—©çš„å‰¯æœ¬ï¼Œå¤§å°åªæœ‰9ä¸ªå­—èŠ‚ï¼Œä¸”é™„å¸¦äº†ä¸€ä¸ªæŒ‡å‘æœ€æ–°å‰¯æœ¬çš„æŒ‡é’ˆã€‚è¿™é‡Œæ­£æ˜¯ git é€šè¿‡å†…éƒ¨ diff çš„æ–¹å¼ï¼Œå°†æäº¤æœ¬èº«çš„å˜æ›´å†…å®¹ä¿ç•™äº†ä¸‹æ¥ï¼ˆå¹¶åšäº†å‹ç¼©ï¼‰ï¼Œæœ€ç»ˆåŠ å…¥åˆ° packfile ä¸­ã€‚

é‚£ä¹ˆè‡³æ­¤æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å›ç­”æ–‡ç« å¼€å¤´çš„é—®é¢˜äº†ï¼š

* `.pack` æ–‡ä»¶æ˜¯ git çš„ packfileï¼Œæ˜¯ git æ‰“åŒ…æ“ä½œåå¯¹æ¾æ•£ git å¯¹è±¡çš„å‹ç¼©æ•´åˆï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†ç£ç›˜å ç”¨çš„ç©ºé—´
* `.pack` æ–‡ä»¶åºå¤§çš„åŸå› ï¼Œæ˜¯å› ä¸ºå®ƒéœ€è¦ä¿ç•™æ•´ä¸ª git ä»“åº“ç»å¤§éƒ¨åˆ†å†å²æäº¤çš„ä¿¡æ¯

ä½†é—®é¢˜è¿˜æ˜¯å­˜åœ¨çš„ï¼šæˆ‘ä»¬çš„å®ä¹ ç”Ÿç”¨äº†1ä¸ªå°æ—¶æ¥ä¸‹è½½ä»£ç ï¼å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

### git ä»“åº“çš„æ¸…ç†

å¦‚æœæˆ‘ä»¬å»è§‚å¯Ÿä¸€äº›å·²æœ‰çš„å¼€å‘ä»“åº“ï¼Œé€šå¸¸ä¼šå‘ç° `.git/objects/pack` é‡Œæœ‰ä¸æ­¢ä¸€ä¸ª `.pack` å’Œ `.idx` æ–‡ä»¶ï¼Œè€Œä¸”æœ‰äº› `.pack` éå¸¸çš„åºå¤§ã€‚äº‹å®ä¸Šï¼Œå¦‚æœæŸä¸ªäººåœ¨ä¹‹å‰å‘é¡¹ç›®æ·»åŠ äº†ä¸€ä¸ªå¤§å°ç‰¹åˆ«å¤§çš„æ–‡ä»¶ï¼Œå³ä½¿ä½ å°†è¿™ä¸ªæ–‡ä»¶ä»é¡¹ç›®ä¸­ç§»é™¤äº†ï¼Œæ¯æ¬¡å…‹éš†è¿˜æ˜¯éƒ½è¦å¼ºåˆ¶çš„ä¸‹è½½è¿™ä¸ªå¤§æ–‡ä»¶ã€‚ ä¹‹æ‰€ä»¥ä¼šäº§ç”Ÿè¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªæ–‡ä»¶åœ¨å†å²ä¸­æ˜¯å­˜åœ¨çš„ï¼Œå®ƒä¼šæ°¸è¿œåœ¨é‚£é‡Œã€‚

æ‰€ä»¥ä¸ºäº†ä»æ ¹æœ¬ä¸Šé¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ git æäº¤å†å²ä¸Šå‡ºç°è¿‡çš„å¤§æ–‡ä»¶è¿›è¡Œæ°¸ä¹…çš„æ¸…ç†ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸éº»çƒ¦çš„äº‹æƒ…ï¼Œè¯»è€…å¯ä»¥å‚è€ƒä»¥ä¸‹å‡ ç¯‡æ–‡ç« ï¼š

* https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-%E7%BB%B4%E6%8A%A4%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D
* https://stackoverflow.com/questions/11050265/remove-large-pack-file-created-by-git
* https://help.github.com/en/articles/removing-sensitive-data-from-a-repository

å½“ç„¶ï¼Œæˆ‘ä¹Ÿä¼šå°½å¿«åœ°åœ¨æˆ‘ä»¬çš„å¼€å‘ä»“åº“ä¸Šåº”ç”¨ä¸€äº›å®è·µï¼Œåç»­ä¼šåœ¨è¿™é‡Œè¡¥å……æ›´å¤šçš„æ“ä½œæ–¹å¼ç»†èŠ‚ã€‚

## Reference

* [Pro Git, 2nd Edition](https://git-scm.com/book/en/v2)
* [æ·±å…¥ç†è§£ git å®ç°åŸç†](https://zhuanlan.zhihu.com/p/45510461)
* [æ”¾å¼ƒç†è§£ gitï¼ˆä¸€ï¼‰ï¼šgit å†…éƒ¨åŸç†](https://zhuanlan.zhihu.com/p/53750883)
* [å›¾è§£gitåŸç†ä¸æ—¥å¸¸å®ç”¨æŒ‡å—](https://juejin.im/post/5c714d18f265da2d98090503#heading-8)
* [git Merge Stretegy Options and Examples](https://www.atlassian.com/git/tutorials/using-branches/merge-strategy)
* [git: Understanding the Index File](https://mincong-h.github.io/2018/04/28/git-index/)
* https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-%E7%BB%B4%E6%8A%A4%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D
* https://stackoverflow.com/questions/11050265/remove-large-pack-file-created-by-git
* https://help.github.com/en/articles/removing-sensitive-data-from-a-repository
